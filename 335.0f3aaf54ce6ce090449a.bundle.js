(()=>{"use strict";const t=Math.pow(10,5);function e(t,e){return`Group:${t}@Item:${e}`}const n=(t,e,n)=>({type:"update-current-trial",detail:{itemGroupIndex:t,itemEntityIndex:e,pickCount:n}});let o=!1;addEventListener("message",(({data:i})=>{"start-simulation"===i.type?function(i,r){const u=100*t,d=r.reduce(((t,e,n)=>{var o,i;const r=null!==(i=null===(o=t.at(-1))||void 0===o?void 0:o.upperBound)&&void 0!==i?i:0;return[...t,...Array.from({length:e.quantity},((t,o)=>({itemGroupIndex:n,itemEntityIndex:o,lowerBound:r+e.normalizedProb*o,upperBound:r+e.normalizedProb*(o+1)})))]}),[]);!function t(r){r>i?postMessage({type:"done"}):function i(s,a){if(o)return o=!1,void postMessage({type:"done"});const p=1e6;for(let o=0;o<p;o+=1){if(a.size>=d.length)return postMessage({type:"end-current-trial"}),void setTimeout((()=>t(r+1)),0);const i=Math.random()*u,p=d.find((t=>t.lowerBound<=i&&i<t.upperBound));void 0===p||a.has(e(p.itemGroupIndex,p.itemEntityIndex))||(a.add(e(p.itemGroupIndex,p.itemEntityIndex)),postMessage(n(p.itemGroupIndex,p.itemEntityIndex,s+o)))}setTimeout((()=>i(s+p,a)),0)}(1,new Set)}(1)}(i.simulationCount,i.itemGroupList):"abort-simulation"===i.type&&(o=!0)}))})();